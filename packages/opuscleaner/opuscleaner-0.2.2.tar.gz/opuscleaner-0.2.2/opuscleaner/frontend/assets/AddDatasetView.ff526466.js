var x=(n,o,l)=>{if(!o.has(n))throw TypeError("Cannot "+l)};var b=(n,o,l)=>(x(n,o,"read from private field"),l?l.call(n):o.get(n)),B=(n,o,l)=>{if(o.has(n))throw TypeError("Cannot add the same private member more than once");o instanceof WeakSet?o.add(n):o.set(n,l)},U=(n,o,l,_)=>(x(n,o,"write to private field"),_?_.call(n,l):o.set(n,l),l);var A=(n,o,l)=>(x(n,o,"access private method"),l);import{_ as ae,i as r,m as S,j as se,aL as ne,k as oe,o as g,c as y,d as s,n as L,bw as le,a4 as j,v as N,f as h,b as T,u as c,F as P,r as J,a as re,T as ie,t as p,bF as ue,p as ce,h as de}from"./index.6cc31f0d.js";import{C as z}from"./vue-select.9ddbca8a.js";function pe(n){const o=n==0?0:Math.floor(Math.log(n)/Math.log(1024));return(n/Math.pow(1024,o)).toFixed(2)+" "+["B","kB","MB","GB","TB"][o]}var d,C,q;class he{constructor(o,l){B(this,C);B(this,d,void 0);this.interval=o,this.callback=l}start(){b(this,d)&&clearTimeout(b(this,d)),U(this,d,setTimeout(A(this,C,q).bind(this),this.interval))}stop(){clearTimeout(b(this,d)),U(this,d,null)}restart(){this.stop(),this.start()}}d=new WeakMap,C=new WeakSet,q=function(){Promise.resolve(this.callback()).then(()=>{b(this,d)&&this.start()})};const m=n=>(ce("data-v-183e5481"),n=n(),de(),n),ve={class:"downloader"},ge=m(()=>s("h1",{class:"datasets-catalogue-title"},[h(" Datasets catalogue "),s("small",null,[s("em",null,"TODO"),h(" datasets")])],-1)),me={class:"search-inputs"},_e={class:"dataset-list"},fe=["id"],we={class:"dataset-name"},be={class:"dataset-title"},ye=["href"],ke=["onClick","disabled"],De={class:"metadata-dataset"},Ve=m(()=>s("dt",null,"Version",-1)),Oe={title:"Version"},Se=m(()=>s("dt",null,"Languages",-1)),Le={title:"Languages"},Te=m(()=>s("dt",null,"Pairs",-1)),Ce={title:"Sentence pairs"},Me=m(()=>s("dt",null,"Size",-1)),$e={title:"Download size"},Ie={class:"downloads-popup"},xe=m(()=>s("summary",null,[s("h2",null,"Downloads")],-1)),Be={__name:"AddDatasetView",setup(n){const o=[{label:"Corpus name",compare:(a,e)=>a.corpus.localeCompare(e.corpus)},{label:"Download size",compare:(a,e)=>e.size-a.size},{label:"Sentence pairs",compare:(a,e)=>e.pairs-a.pairs}],l=r(o[0]),_=r(0),M=new Map,$=new Map,k=r(""),D=r(!0),V=r(!0),O=r(!0),i=r(),f=r(),F=r(),G=S(()=>{if(!i.value)return[];if(!M.has(i.value)){const a=r([]);M.set(i.value,a),Y(i.value).then(e=>{a.value=e})}return M.get(i.value).value}),H=S(()=>{const a=new Intl.DisplayNames([],{type:"language",languageDisplay:"standard"});return(F.value||[]).map(e=>{try{return{lang:e,label:`${a.of(e)} (${e})`}}catch{return{lang:e,label:e}}})}),K=S(()=>{const a=new Intl.DisplayNames([],{type:"language",languageDisplay:"standard"});return(G.value||[]).map(e=>{try{return{lang:e,label:`${a.of(e)} (${e})`}}catch{return{lang:e,label:e}}})}),Q=S(()=>{if(!i.value||!f.value)return[];const a=`${i.value}-${f.value}`;if(!$.has(a)){const t=r([]);$.set(a,t),Z(i.value,f.value).then(u=>{t.value=u})}let e=$.get(a).value;return k.value.length>0&&(e=e.filter(({corpus:t,group:u})=>t.toLowerCase().indexOf(k.value.toLowerCase())!==-1)),e=e.filter(t=>t.langs.length>1?O.value:V.value),D.value&&(e=Array.from(e.reduce((t,u)=>((!t.has(u.corpus)||t.get(u.corpus).version<u.version)&&t.set(u.corpus,u),t),new Map).values())),e.sort(l.value.compare),e}),v=se({});ne(async()=>{X().then(a=>{F.value=a}),E().then(a=>{Object.assign(v,I(a))})});let R=new he(1e3,async()=>{const a=await E();Object.assign(v,I(a))});oe(v,a=>{const e=new Set(["pending","downloading"]);Object.values(a).some(t=>e.has(t.state))?R.restart():R.stop()});function I(a){return Object.fromEntries(a.map(e=>[e.entry.id,e]))}function W(a){ee([a]).then(e=>{Object.assign(v,I(e))})}async function w(a,e){try{return _.value+=1,await(await fetch(a,e)).json()}finally{_.value-=1}}async function X(){return await w("/api/download/languages/")}async function Y(a){return await w(`/api/download/languages/${encodeURIComponent(a)}`)}async function Z(a,e){const t=`${a}-${e}`;return await w(`/api/download/by-language/${encodeURIComponent(t)}`)}async function E(){return await w("/api/download/downloads/")}async function ee(a){return await w("/api/download/downloads/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a.map(({id:e})=>({id:e})))})}const te=new Intl.NumberFormat;return(a,e)=>(g(),y("div",ve,[ge,s("div",me,[s("label",null,[L(s("input",{type:"search",placeholder:"Search dataset\u2026","onUpdate:modelValue":e[0]||(e[0]=t=>k.value=t)},null,512),[[le,k.value]])]),s("label",{class:j(["search-button",{checked:V.value}])},[L(s("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=t=>V.value=t)},null,512),[[N,V.value]]),h(" Monolingual ")],2),s("label",{class:j(["search-button",{checked:O.value}])},[L(s("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=t=>O.value=t)},null,512),[[N,O.value]]),h(" Bilingual ")],2),s("label",{class:j(["search-button",{checked:D.value}])},[L(s("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=t=>D.value=t)},null,512),[[N,D.value]]),h(" Latest only ")],2),s("label",null,[T(c(z),{modelValue:i.value,"onUpdate:modelValue":e[4]||(e[4]=t=>i.value=t),options:c(H),reduce:({lang:t})=>t,placeholder:"Origin language"},null,8,["modelValue","options","reduce"])]),s("label",null,[T(c(z),{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=t=>f.value=t),options:c(K),reduce:({lang:t})=>t,placeholder:"Target language"},null,8,["modelValue","options","reduce"])]),s("label",null,[T(c(z),{modelValue:l.value,"onUpdate:modelValue":e[6]||(e[6]=t=>l.value=t),options:o,placeholder:"Sort order"},null,8,["modelValue"])])]),s("div",_e,[(g(!0),y(P,null,J(c(Q),t=>(g(),y("div",{class:"dataset",key:t.id,id:`did-${t.id}`},[s("div",we,[s("h3",be,[s("a",{href:`https://opus.nlpl.eu/${t.corpus}-${t.version}.php`,target:"_blank"},p(t.corpus),9,ye)]),s("button",{class:"download-dataset-button",onClick:u=>W(t),disabled:t.id in v||"paths"in t},[h(" Download "),T(c(ue),{class:"download-icon"})],8,ke)]),s("dl",De,[Ve,s("dd",Oe,p(t.version),1),Se,s("dd",Le,p(t.langs.join("\u2192")),1),Te,s("dd",Ce,p(t.pairs?c(te).format(t.pairs):""),1),Me,s("dd",$e,p(t.size?c(pe)(t.size):""),1)])],8,fe))),128))]),(g(),re(ie,{to:".navbar"},[s("details",Ie,[xe,s("ul",null,[(g(!0),y(P,null,J(v,t=>(g(),y("li",{key:t.entry.id},[h(p(t.entry.corpus)+" ",1),s("em",null,p(t.state),1)]))),128))])])]))]))}},ze=ae(Be,[["__scopeId","data-v-183e5481"]]);export{ze as default};
