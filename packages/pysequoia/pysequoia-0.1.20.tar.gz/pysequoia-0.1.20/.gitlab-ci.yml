image: jdrouet/docker-with-buildx:stable

services:
  - docker:dind

build:
  script:
    - docker build --file ci/build.dockerfile .

integration:
  script:
    - docker build --file ci/e2e.dockerfile .

audit:
  script:
    - docker build --file ci/audit.dockerfile .

pages:
  before_script:
    - docker context create builders
    - docker buildx create --use builders
  script:
    - docker buildx build --file ci/docs.dockerfile --output type=local,dest=public .
  artifacts:
    paths:
      - public
