var $e=Object.defineProperty;var Ae=(n,t,r)=>t in n?$e(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r;var _=(n,t,r)=>(Ae(n,typeof t!="symbol"?t+"":t,r),r);import{j as z,r as g,u as ve,a as qe,F as _e,b as Fe,c as Me,d as je,e as Ue,f as Ke,g as Ve,h as Qe,P as We,D as Xe,i as Be,k as Ge,A as C,I as w,l as Y,m as He,n as N,o as ze,U as v,p as S,q as xe,s as be,t as m,v as A,_ as Ye,W as J,$ as k,L as $,C as Je,X as Ze,S as et,w as tt,N as nt,E as rt,x as we,y as Ne,z as Z,B as Ce,G as ee,H as te,Z as ne,J as O,K as P,M as re,Q as R,O as D,R as st,T as it,V as Le,Y as at,a0 as ot,a1 as ct,a2 as se,a3 as M,a4 as Pe,a5 as he,a6 as lt,a7 as me,a8 as pe,a9 as Re,aa as dt,ab as ut,ac as ht,ad as mt,ae as pt,af as gt,ag as ft,ah as yt,ai as vt,aj as xt}from"./vendor-ccd85f8c.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();const T=z.Fragment,e=z.jsx,i=z.jsxs;class bt extends Error{constructor(r,a){const s=r.status||r.status===0?r.status:"",o=r.statusText||"",c=`${s} ${o}`.trim(),h=c?`status code ${c}`:"an unknown error";super(`Request failed with ${h}`);_(this,"response");_(this,"request");this.name="HTTPError",this.response=r,this.request=a}}const wt=n=>{const t=new URLSearchParams;return Object.entries(n).forEach(([r,a])=>{a!==void 0&&t.set(r,a)}),t};class Nt{constructor(t={}){_(this,"config");var r;this.config=t,this.config.baseUrl=(r=this.config.baseUrl)==null?void 0:r.replace(/\/+$/,"")}get baseUrl(){return this.config.baseUrl}async fetch(t){let r,a;if(typeof t=="string")r=t;else{const{url:c,params:h,json:d,...u}=t;if(r=c,a=u,d&&(a.body=JSON.stringify(d),a.headers={"Content-Type":"application/json"}),h){const f=wt(h);r+=`?${f}`}}this.config.baseUrl&&(r=this.config.baseUrl+r);const s=new Request(r,{...a,credentials:"include"}),o=await fetch(s);if(!o.ok)throw new bt(o,s);return o.headers.get("Content-Type")==="application/json"?await o.json():await o.text()}async fetchForceMethod(t,r){return typeof t=="string"?this.fetch({url:t,method:r}):this.fetch({...t,method:r})}async get(t){return this.fetchForceMethod(t,"get")}async post(t){return this.fetchForceMethod(t,"post")}async put(t){return this.fetchForceMethod(t,"put")}async patch(t){return this.fetchForceMethod(t,"patch")}async delete(t){return this.fetchForceMethod(t,"delete")}}const Ct=`${window.location.protocol}//${window.location.host}/api`,K={}.VITE_API_BASE_URL||Ct,L=new Nt({baseUrl:K}),Lt=()=>L.baseUrl,Pt=async()=>await L.get("/whoami"),Rt=async()=>{await L.post("/logout")},ie=()=>{const n=new URL(K);return n.protocol="ws",n.pathname+="/ws",n},St=async()=>await L.get("/pipelines"),ae=async n=>await L.get(`/pipelines/${n}`),Tt=async n=>await L.get(`/pipelines/${n}/input-schema`),oe=async(n,t)=>{const r={pipeline_id:n,trigger_id:t},a=await L.get({url:"/runs",params:r});return a.forEach(s=>{s.start_time=new Date(s.start_time)}),a},kt=async n=>{const t=await L.get(`/runs/${n}`);return t.start_time=new Date(t.start_time),t},Ot=async n=>(await L.get(`/runs/${n}/logs`)).split(`
`).map((r,a)=>{const s=JSON.parse(r);return s.id=a,s.timestamp=new Date(s.timestamp),s}),Dt=async(n,t)=>await L.get(`/runs/${n}/data/${t}`),B=n=>`${K}/pipelines/${n}/run`,Et=n=>({async mutationFn(t){L.post({url:`/pipelines/${n}/run`,json:t})}}),F=(n,t,r=!0)=>`${r?K:""}/pipelines/${n}/triggers/${t}/run`,It=async(n,t)=>await L.post(F(n,t,!1)),Se=g.createContext({isAuthenticated:!1,isAuthenticationEnabled:!0,isLoading:!0,logout:async()=>{},user:null}),$t=(n,t)=>{switch(t.type){case"LOGIN":return{...n,isAuthenticated:!0,isAuthenticationEnabled:t.payload.isAuthenticationEnabled,user:t.payload.user};case"LOGOUT":return{...n,isAuthenticated:!1,user:null};case"POPULATE":return{...n,user:t.payload?{...n.user,...t.payload}:null};case"STOP_LOADING":return{...n,isLoading:!1};default:throw new Error("Unknown action type")}},At=({children:n})=>{const[t,r]=g.useReducer($t,{isAuthenticated:!1,isAuthenticationEnabled:!0,isLoading:!0,logout:async()=>{await Rt(),r({type:"LOGOUT"})},user:null});return g.useEffect(()=>{(async()=>{try{const{is_authentication_enabled:s,user:o}=await Pt();(s&&o||!s)&&r({type:"LOGIN",payload:{user:o,isAuthenticationEnabled:s}})}catch(s){console.error(s)}finally{r({type:"STOP_LOADING"})}})()},[]),e(Se.Provider,{value:t,children:t.isAuthenticationEnabled&&t.isLoading?"Loading...":n})},ce=()=>g.useContext(Se),qt=n=>`translate${n==="bottom"||n==="top"?"Y":"X"}(${n==="bottom"||n==="right"?"-":"+"}10%)`;function _t({initialOpen:n=!1,placement:t="bottom",modal:r,open:a,onOpenChange:s}={}){const[o,c]=g.useState(n),[h,d]=g.useState(),[u,f]=g.useState(),l=a??o,y=s??c,b=je({placement:t,open:l,onOpenChange:y,whileElementsMounted:We,middleware:[Xe(5),Be({fallbackAxisSideDirection:"end"}),Ge({padding:5})]}),p=b.context,x=Ue(p,{enabled:a==null}),E=Ke(p),X=Ve(p),q=Qe([x,E,X]);return g.useMemo(()=>({open:l,setOpen:y,...q,...b,modal:r,labelId:h,descriptionId:u,setLabelId:d,setDescriptionId:f}),[l,y,q,b,r,h,u])}const Te=g.createContext(null),V=()=>{const n=g.useContext(Te);if(n==null)throw new Error("Popover components must be wrapped in <Popover />");return n};function Ft({children:n,modal:t=!0,...r}){const a=_t({modal:t,...r});return e(Te.Provider,{value:a,children:n})}const Mt=g.forwardRef(function({children:t,asChild:r=!1,...a},s){const o=V(),c=t.ref,h=ve([o.refs.setReference,s,c]);return r&&g.isValidElement(t)?g.cloneElement(t,o.getReferenceProps({ref:h,...a,...t.props,"data-state":o.open?"open":"closed"})):e("button",{ref:h,type:"button","data-state":o.open?"open":"closed",...o.getReferenceProps(a),children:t})}),jt=g.forwardRef(function(t,r){const{context:a,...s}=V(),o=ve([s.refs.setFloating,r]),{isMounted:c,styles:h}=qe(a,{initial:({side:d})=>({opacity:0,transform:qt(d)})});return e(_e,{children:c&&e(Fe,{context:a,modal:s.modal,children:e("div",{ref:o,style:{position:s.strategy,top:s.y??0,left:s.x??0,width:"max-content",...t.style,...h},"aria-labelledby":s.labelId,"aria-describedby":s.descriptionId,...s.getFloatingProps(t),children:t.children})})})});g.forwardRef(function({children:t,...r},a){const{setDescriptionId:s}=V(),o=Me();return g.useLayoutEffect(()=>(s(o),()=>s(void 0)),[o,s]),e("p",{...r,ref:a,id:o,children:t})});g.forwardRef(function(t,r){const{setOpen:a}=V();return e("button",{type:"button",ref:r,...t,onClick:s=>{var o;(o=t.onClick)==null||o.call(t,s),a(!1)}})});const Ut=()=>{const{logout:n,user:t}=ce();if(!t)return e("div",{children:"Not logged in"});const r=t.name.split(" "),a=r.length>1?`${r.at(0)[0]}${r.at(-1)[0]}`:r[0];return i(Ft,{placement:"bottom-start",children:[e(Mt,{children:e("div",{className:"flex justify-center items-center font-medium bg-white ring-1 ring-slate-200 text-indigo-500 rounded-full ml-4 hover:ring-2 transition-shadow",style:{width:34,height:34},children:a})}),e(jt,{children:i(C,{className:"shadow-xl",children:[e(w,{children:t.name}),e(Y,{children:t.email}),e(He,{}),e(N,{size:"xs",variant:"secondary",color:"rose",icon:ze,className:"w-full",onClick:async()=>await n(),children:"Logout"})]})})]})},Q=({children:n,header:t})=>{const{isAuthenticated:r,isAuthenticationEnabled:a}=ce();return i("div",{className:"bg-slate-50 p-6 sm:p-10 min-h-screen",children:[i(v,{className:"items-start",children:[t&&e("div",{className:"flex-grow max-w-full",children:t}),r&&a&&e(Ut,{})]}),e("main",{children:n})]})},W=({children:n,footer:t,isOpen:r,maxHeight:a,maxWidth:s="600px",minWidth:o="350px",subtitle:c,title:h,onClose:d})=>{const u=g.createRef();return g.useEffect(()=>{var l,y;r?(l=u.current)==null||l.showModal():(y=u.current)==null||y.close()},[r]),e("dialog",{ref:u,style:{padding:0,background:"transparent",overflow:"visible",maxHeight:a,maxWidth:s,minWidth:o},onClick:l=>{var p;var y=u.current.getBoundingClientRect(),b=y.top<=l.clientY&&l.clientY<=y.top+y.height&&y.left<=l.clientX&&l.clientX<=y.left+y.width;b||(d?d():(p=u.current)==null||p.close())},children:i(C,{children:[h&&e(w,{children:h}),c&&e(Y,{children:c}),e("div",{className:(h||c)&&"mt-6",children:n}),t&&e(v,{className:"justify-end space-x-6 mt-6",children:t})]})})},Kt=n=>{const t=s=>{if(!n.definitions)return;const o=s.split("/").pop();return n.definitions[o]},r=n.properties;if(!r)return e(m,{className:"mt-4",children:"This pipeline has no input"});const a=Object.entries(r).map(([s,o])=>{var l,y,b;if(typeof o=="boolean")return;let c=o,h;if(o.allOf){const p=o.allOf[0];if(h=(l=o.default)==null?void 0:l.toString(),p.$ref){const x=t(p.$ref);x&&(c=x)}}else if(o.$ref){const p=t(o.$ref);p&&(c=p)}else h=(y=c.default)==null?void 0:y.toString();const d=c.title||s,u=(c.enum?"enum":Array.isArray(c.type)?c.type[0]:c.type)||"string",f=(b=n.required)==null?void 0:b.includes(s);if(["number","integer"].includes(u)){const p=c.minimum||c.exclusiveMinimum,x=c.maximum||c.exclusiveMaximum;if(p!==void 0&&x!==void 0){const E=g.createRef(),X=u==="number"?(x-p)/10:1;return i("div",{children:[e(m,{children:d}),e("input",{name:s,type:"range",min:p,max:x,step:X,defaultValue:h,required:f,onInput:q=>E.current&&(E.current.value=q.target.value),className:"w-full mt-2 cursor-ew-resize appearance-none h-2 bg-slate-200 border border-slate-400 rounded"}),i(v,{className:"items-baseline space-x-4",children:[i("div",{className:"ml-1",children:[e("div",{className:"border-r border-slate-300 h-2 w-1"}),e(m,{children:p})]}),e(m,{children:e(A,{children:e("output",{ref:E,className:"px-2 py-1 rounded bg-slate-200 block truncate text-center",children:h})})}),i("div",{className:"mr-1",children:[e("div",{className:"border-r border-slate-300 h-2 w-1"}),e(m,{children:x})]})]})]},s)}else return i("div",{children:[e(m,{children:d}),e("input",{name:s,type:"number",min:p,max:x,defaultValue:h,className:"border-gray-300 rounded-md border shadow-sm px-4 py-2 text-sm font-medium invalid:border-rose-500 mt-2",style:{textAlign:"end",width:"100%"},required:f})]},s)}else return u==="enum"?i("div",{children:[e(m,{children:d}),i("select",{name:s,defaultValue:h||"",className:"border-gray-300 rounded-md border shadow-sm px-4 py-2 text-sm font-medium w-full invalid:border-rose-500 mt-2",required:f,children:[e("option",{disabled:!0,value:"",children:"Select..."}),c.enum.map(p=>e("option",{value:p.toString(),children:p==null?void 0:p.toString()},p==null?void 0:p.toString()))]})]},s):i("div",{children:[i(m,{children:[d," ",f&&"*"]}),e(Ye,{name:s,placeholder:d,defaultValue:h,className:"mt-2"})]},s)});return e("div",{className:"space-y-4",children:a})},le=({pipeline:n})=>{const[t,r]=g.useState(!1),a=S({queryKey:["pipeline-input",n.id],queryFn:()=>Tt(n.id),enabled:t}),s=xe(Et(n.id));return i(T,{children:[e(N,{color:"indigo",variant:"secondary",size:"xs",icon:be,onClick:()=>r(!0),children:"Run"}),e(W,{isOpen:t,title:`Run ${n.name} manually`,onClose:()=>r(!1),children:i("form",{method:"dialog",onSubmit:o=>{const c=Object.fromEntries(new FormData(o.target).entries());s.mutateAsync(c)},children:[a.isLoading?"Loading...":e("div",{style:{width:350},children:Kt(a.data)}),i(v,{className:"justify-end space-x-6 mt-6",children:[e(N,{variant:"secondary",color:"indigo",onClick:()=>{r(!1)},children:"Close"}),e(N,{color:"indigo",type:"submit",children:"Run"})]})]})})]})},Vt=()=>{const n=S({queryKey:["pipelines"],queryFn:St,initialData:[]});if(n.isLoading)return e("div",{children:"Loading..."});if(n.error)return e("div",{children:"An error has occurred"});const t=n.data;return i(C,{children:[e(w,{children:"Pipelines"}),e(J,{children:t.map(r=>i(k,{children:[i("div",{className:"min-w-0",children:[e(m,{className:"truncate",children:e(A,{children:e($,{to:`/pipelines/${r.id}`,children:r.name})})}),r.description&&e(m,{className:"truncate",children:r.description})]}),e(le,{pipeline:r})]},r.id))})]})},j={completed:"emerald",failed:"rose",cancelled:"slate",running:"blue",notrun:"slate",warning:"amber"},G={completed:Je,failed:Ze,cancelled:et,running:tt,notrun:nt,warning:rt},H=["cyan","violet","pink","emerald","orange","stone","fuchsia"],ke=n=>Object.fromEntries(n.map((t,r)=>[t.id,`bg-${H[r%H.length]}-500`])),Qt=n=>we(n).format("D MMM YYYY HH:mm:ss (Z[Z])"),Wt=n=>we(n).format("HH:mm:ss.SSS"),Oe=({status:n})=>e(Ne,{color:j[n],icon:G[n],children:n}),Xt=({startTime:n})=>{const[t,r]=g.useState(Date.now()-n.getTime());return g.useEffect(()=>{const a=setInterval(()=>{r(Date.now()-n.getTime())},500);return()=>{clearInterval(a)}}),e("span",{children:(t/1e3).toFixed(2)})},de=({pipelineId:n,runs:t,triggerId:r})=>{const[a,s]=g.useState(t),o=Z(),c=Ce(),{lastJsonMessage:h}=ee(ie().toString()),d=g.useCallback(u=>{const{data:f,type:l}=u;if(l==="run-update")if(f.run.start_time=new Date(f.run.start_time),f.run.trigger_id=f.trigger,f.run.status==="running")s([f.run,...a]);else{let y=[...a];const b=y.findIndex(p=>p.id===f.run.id);b>=0?y[b]=f.run:y=[f.run,...y],s(y),o.invalidateQueries({queryKey:["runs",n,r]})}},[n,o,a,r]);return g.useEffect(()=>{h&&d(h)},[h]),g.useEffect(()=>{t.length&&s(t)},[t]),i(C,{children:[e(w,{children:"Runs"}),i(te,{children:[e(ne,{children:i(O,{children:[e(P,{className:"text-right",children:"#"}),e(P,{children:"Status"}),!r&&e(P,{children:"Trigger"}),e(P,{children:"Started at"}),e(P,{className:"text-right",children:"Duration"})]})}),e(re,{children:a.map(u=>i(O,{className:"cursor-pointer hover:bg-slate-50 transition-colors",onClick:()=>c(`/pipelines/${u.pipeline_id}/triggers/${u.trigger_id}/runs/${u.id}`),children:[e(R,{className:"text-right",children:u.id}),e(R,{children:e(Oe,{status:u.status})}),!r&&e(R,{children:e($,{to:`/pipelines/${u.pipeline_id}/triggers/${u.trigger_id}`,className:"link--arrow",title:"View trigger details",onClick:f=>f.stopPropagation(),children:u.trigger_id})}),e(R,{children:e(m,{children:Qt(u.start_time)})}),i(R,{className:"text-right",children:[u.status!=="running"?(u.duration/1e3).toFixed(2):e(Xt,{startTime:u.start_time})," ","s"]})]},u.id))})]})]})},Bt=()=>{const n=S({queryKey:["runs",void 0,void 0],queryFn:()=>oe(),initialData:[]});return n.isLoading?e("div",{children:"Loading..."}):n.error?e("div",{children:"An error has occurred"}):e(Q,{header:e(T,{children:e(w,{children:"Plombery"})}),children:i(D,{numColsMd:2,className:"gap-6 mt-6",children:[e(Vt,{}),n.isLoading?"Loading...":n.isError?"Error loading runs":e(de,{runs:n.data})]})})},Gt=()=>e("div",{className:"h-screen flex justify-center items-center bg-slate-200",children:i(C,{className:"w-auto",children:[e("div",{className:"w-12 rounded-full mx-auto mb-4",children:e("img",{src:"/mario-pipe-flower.png",alt:"Plombery logo"})}),e(w,{className:"mb-6",children:"Welcome to Plombery"}),e(N,{onClick:()=>{location.href=`${Lt()}/login`},size:"lg",color:"indigo",className:"shadow-none w-full",children:"Login"})]})}),De=({content:n})=>{const[t,r]=g.useState(!1),a=g.useRef();return e(N,{variant:"light",color:"indigo",size:"sm",icon:t?st:it,onClick:()=>{navigator.clipboard.writeText(n),r(!0),a.current=setTimeout(()=>r(!1),3e3)}})},I=()=>e(m,{children:"/"}),ue=({pipeline:n,trigger:t,run:r,className:a})=>{if(r&&!t)throw new Error;return i(v,{className:`gap-x-2 justify-start flex-wrap ${a||""}`,children:[e(m,{children:e($,{to:"/",children:"Pipelines"})}),e(I,{}),e(m,{children:t?e($,{to:`/pipelines/${n.id}`,children:n.name}):n.name}),t&&i(T,{children:[e(I,{}),e(m,{children:"Triggers"}),e(I,{}),e(m,{children:r?e($,{to:`/pipelines/${n.id}/triggers/${t.id}`,children:t.name}):t.name})]}),r&&t&&i(T,{children:[e(I,{}),e(m,{children:"Runs"}),e(I,{}),i(m,{children:["#",r.id]})]})]})},ge=n=>(n/1e3).toFixed(1)+" s",Ee=({runs:n})=>{const t=n.filter(a=>a.status==="completed").reverse(),r=t.reduce((a,s)=>a+s.duration,0)/t.length||0;return i(C,{children:[e(v,{className:"items-start",children:e(m,{children:"Duration"})}),e(v,{className:"justify-start items-baseline space-x-3 truncate",children:e(Le,{children:ge(r)})}),e(at,{data:t,index:"id",categories:["duration"],colors:["indigo"],valueFormatter:ge,yAxisWidth:40,showLegend:!1,autoMinValue:!0,className:"mt-6 h-28"})]})},Ie=({runs:n,subject:t})=>{var c,h;const a=n.filter(d=>d.status==="completed").length/n.length*100||0,s=(c=n[0])==null?void 0:c.start_time,o=(h=n[n.length-1])==null?void 0:h.start_time;return i(C,{children:[e(v,{children:i(w,{children:[t," health"]})}),n.length?i(T,{children:[i(v,{className:"mt-4",children:[e(m,{children:"Successful runs"}),i(m,{children:[a.toFixed(1)," %"]})]}),e(ot,{className:"mt-2",data:n.map(d=>({key:d.id,color:j[d.status],tooltip:`#${d.id} ${d.status}`}))})]}):e(m,{className:"text-center mt-8",children:i(ct,{children:["This ",t.toLowerCase()," has no runs yet"]})}),i(v,{className:"mt-2",children:[e(m,{children:s&&s.toDateString()}),e(m,{children:o&&o.toDateString()})]})]})},Ht=({pipeline:n})=>{const t=Ce();return i(C,{children:[e(w,{children:"Triggers"}),i(te,{children:[e(ne,{children:i(O,{children:[e(P,{children:"Name"}),e(P,{children:"Interval"})]})}),e(re,{children:n.triggers.map(r=>i(O,{className:"cursor-pointer hover:bg-slate-50 transition-colors",onClick:()=>t(`/pipelines/${n.id}/triggers/${r.id}`),children:[e(R,{children:r.name}),e(R,{children:e(m,{children:r.schedule})})]},r.id))})]})]})},zt=()=>{const t=se().pipelineId,r=S({queryKey:["pipeline",t],queryFn:()=>ae(t),initialData:{id:"",name:"",description:"",tasks:[],triggers:[]},enabled:!!t}),a=S({queryKey:["runs",t,void 0],queryFn:()=>oe(t),initialData:[]});if(a.isLoading||r.isLoading)return e("div",{children:"Loading..."});if(a.error||r.error)return e("div",{children:"An error has occurred"});const s=r.data;return i(Q,{header:i("div",{children:[i(v,{className:"items-start",children:[i(v,{className:"justify-start items-start md:items-center flex-col md:flex-row min-w-0",children:[i(w,{className:"truncate max-w-full",children:["Pipeline ",s.name]}),s.description&&i(m,{className:"truncate max-w-full",children:[e("span",{className:"hidden md:inline mx-2",children:"·"}),s.description]})]}),e(le,{pipeline:s})]}),e(ue,{pipeline:s,className:"mt-4"})]}),children:[i(D,{numColsMd:2,numColsLg:3,className:"gap-6 mt-6",children:[i(C,{className:"flex flex-col h-full",children:[e(w,{children:"Tasks"}),e(J,{children:s.tasks.map(o=>e(k,{children:i("div",{children:[e(m,{children:e(A,{children:o.name})}),o.description&&e(m,{className:"truncate",children:o.description})]})},o.id))}),e("div",{style:{flexGrow:1}}),i(k,{children:[i(v,{className:"justify-start",children:[e(m,{children:"Run URL"}),e(M,{size:"sm",color:"slate",icon:Pe,tooltip:"URL to run the pipeline programmatically via an HTTP POST request"})]}),i(v,{className:"justify-end",children:[e("div",{className:"bg-slate-100 border-slate-300 rounded border text-slate-500 text-xs truncate px-1 py-0.5 mr-2",style:{maxWidth:200},title:B(t),children:B(t)}),e(De,{content:B(t)})]})]})]}),e(Ie,{subject:"Pipeline",runs:[...a.data].reverse()}),e(Ee,{runs:a.data})]}),i(D,{numCols:1,numColsSm:1,numColsMd:1,numColsLg:2,className:"gap-6 mt-6",children:[e(he,{children:e(Ht,{pipeline:s})}),e(he,{children:e(de,{runs:a.data,pipelineId:t})})]})]})},Yt=({trigger:n})=>{const[t,r]=g.useState(!1);return i(T,{children:[e(N,{color:"indigo",variant:"light",size:"sm",icon:lt,onClick:()=>r(!0),children:"Show params"}),e(W,{isOpen:t,title:"Trigger params",subtitle:n.name,footer:e(N,{variant:"primary",color:"indigo",onClick:()=>{r(!1)},children:"Close"}),onClose:()=>r(!1),children:e("pre",{className:"p-3 bg-slate-100 rounded-md",children:JSON.stringify(n.params,null,2)})})]})},U={id:"_manual",name:"Manual",description:"Special trigger that identifies pipelines run manually by the user"},Jt=()=>{const n=se(),t=n.pipelineId,r=n.triggerId,a=S({queryKey:["pipeline",t],queryFn:()=>ae(t),initialData:{id:"",name:"",description:"",tasks:[],triggers:[]},enabled:!!t}),s=S({queryKey:["runs",t,r],queryFn:()=>oe(t,r),initialData:[],enabled:!!r}),o=xe({mutationFn:()=>It(t,r)});if(s.isLoading||a.isLoading)return e("div",{children:"Loading..."});if(s.error||a.error)return e("div",{children:"An error has occurred"});const c=a.data,h=r===U.id,d=h?U:c.triggers.find(f=>f.id===r);if(!d)return e("div",{children:"Trigger not found"});const u=h?e(le,{pipeline:c}):e(N,{size:"xs",color:"indigo",variant:"secondary",icon:be,onClick:()=>{o.mutateAsync()},children:"Run"});return i(Q,{header:i("div",{children:[i(v,{className:"items-start",children:[i(v,{className:"justify-start items-start md:items-center flex-col md:flex-row min-w-0",children:[i(w,{className:"truncate max-w-full",children:["Trigger ",d.name]}),d.description&&i(m,{className:"truncate max-w-full",children:[e("span",{className:"hidden md:inline mx-2",children:"·"}),d.description]})]}),u]}),e(ue,{pipeline:c,trigger:d,className:"mt-4"})]}),children:[i(D,{numColsMd:2,numColsLg:3,className:"gap-6 mt-6",children:[i(C,{className:"flex flex-col h-full",children:[e(w,{children:d.name}),e(Y,{children:d.description}),e("div",{style:{flexGrow:1}}),i(k,{children:[e(m,{children:"Schedule"}),e(m,{children:e(A,{children:d.schedule})})]}),i(k,{children:[e(m,{children:"Params"}),d.params?e(Yt,{trigger:d}):e(m,{children:e("em",{children:"No params"})})]}),i(k,{children:[i(v,{className:"justify-start",children:[e(m,{children:"Run URL"}),e(M,{size:"sm",color:"slate",icon:Pe,tooltip:"URL to run the trigger programmatically via an HTTP POST request"})]}),i(v,{className:"justify-end",children:[e("div",{className:"bg-slate-100 border-slate-300 rounded border text-slate-500 text-xs truncate px-1 py-0.5 mr-2",style:{maxWidth:200},title:F(t,r),children:F(t,r)}),e(De,{content:F(t,r)})]})]})]}),e(Ie,{subject:"Trigger",runs:[...s.data].reverse()}),e(Ee,{runs:s.data})]}),e("div",{className:"mt-6",children:e(de,{runs:s.data,pipelineId:t,triggerId:r})})]})},Zt=({logEntry:n})=>{const[t,r]=g.useState(!1);return i(v,{className:"mt-1",children:[e(N,{color:"rose",variant:"secondary",size:"xs",onClick:()=>r(!0),children:"Traceback info"}),e(W,{isOpen:t,title:"Traceback info",footer:e(N,{variant:"primary",color:"indigo",onClick:()=>{r(!1)},children:"Close"}),maxWidth:"80%",onClose:()=>r(!1),children:e("div",{className:"flex flex-col",children:e("div",{style:{minWidth:350,maxWidth:"100%",overflow:"auto",flexGrow:1,maxHeight:"70vh"},className:"p-3 my-3 bg-slate-100 rounded-md whitespace-pre font-mono",children:n.exc_info})})})]})},fe={DEBUG:"slate",INFO:"sky",WARNING:"amber",ERROR:"rose"},en=({pipeline:n,runId:t})=>{const[r,a]=g.useState({levels:[],tasks:[]}),{lastJsonMessage:s}=ee(ie().toString()),o=Z(),c=S({queryKey:["logs",t],queryFn:()=>Ot(t),enabled:!!t,initialData:[]}),h=g.useCallback(l=>{const{data:y,type:b}=l;b==="logs"&&o.setQueryData(["logs",t],(p=[])=>{const x=JSON.parse(y);return x.id=p.length,x.timestamp=new Date(x.timestamp),[...p,x]})},[t]);g.useEffect(()=>{s&&h(s)},[s]);const d=g.useCallback(l=>{a(y=>({...y,...l}))},[]);if(c.isLoading)return e("div",{children:"Loading..."});if(c.isError)return e("div",{children:"Error loading logs"});const u=c.data.filter(l=>(r.levels.length===0||r.levels.includes(l.level))&&(r.tasks.length===0||r.tasks.includes(l.task))),f=ke(n.tasks);return i(T,{children:[i(D,{numColsMd:3,className:"gap-6",children:[i("div",{children:[e(m,{children:"Tasks"}),e(me,{className:"mt-1",onValueChange:l=>{d({tasks:l})},children:n.tasks.map(l=>e(pe,{text:l.name,value:l.id},l.id))})]}),i("div",{children:[e(m,{children:"Log level"}),e(me,{className:"mt-1",onValueChange:l=>{d({levels:l})},children:Object.keys(fe).map(l=>e(pe,{text:l,value:l},l))})]})]}),e("div",{className:"logs-table",children:i(te,{className:"mt-6",children:[e(ne,{children:i(O,{children:[e(P,{children:"Time"}),e(P,{children:"Level"}),e(P,{children:"Task"}),e(P,{children:"Message"})]})}),e(re,{children:u.map((l,y)=>{const b=y!==0?l.timestamp.getTime()-u[y-1].timestamp.getTime():-1;return i(O,{children:[i(R,{children:[e("span",{className:"font-mono text-xs text-slate-500",children:Wt(l.timestamp)}),b>=0&&i("span",{className:"font-mono text-xs text-slate-500 ml-2",children:["+",b," ms"]})]}),e(R,{children:e(Ne,{size:"xs",color:fe[l.level],children:l.level})}),e(R,{children:i(v,{children:[e("div",{className:`h-2 w-2 mr-2 rounded-full ${f[l.task]}`}),l.task]})}),i(R,{children:[e(m,{children:l.message}),l.exc_info&&e(Zt,{logEntry:l})]})]},l.id)})})]})})]})},tn="modulepreload",nn=function(n){return"/"+n},ye={},rn=function(t,r,a){if(!r||r.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(r.map(o=>{if(o=nn(o),o in ye)return;ye[o]=!0;const c=o.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(!!a)for(let f=s.length-1;f>=0;f--){const l=s[f];if(l.href===o&&(!c||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${h}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":tn,c||(u.as="script",u.crossOrigin=""),u.href=o,document.head.appendChild(u),c)return new Promise((f,l)=>{u.addEventListener("load",f),u.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>t())},sn=Re.lazy(()=>rn(()=>import("./HandsonTable-9a30dd71.js"),["assets/HandsonTable-9a30dd71.js","assets/vendor-ccd85f8c.js","assets/HandsonTable-a8e02e84.css"])),an=({runId:n,taskId:t,open:r,onClose:a})=>{const s=S({queryKey:["getRunData",{runId:n,taskId:t}],queryFn:()=>Dt(n,t),enabled:r});return e(T,{children:i(W,{title:t,subtitle:"View data",isOpen:r,maxWidth:"90%",minWidth:"90%",footer:e(N,{variant:"secondary",color:"indigo",onClick:()=>a(),children:"Close"}),onClose:a,children:[!s.isLoading&&!s.isError&&e(g.Suspense,{fallback:e("div",{children:"Loading..."}),children:e(sn,{data:s.data,rowHeaders:!0,colHeaders:Object.keys(s.data[0]),height:"70vh",width:"100%",licenseKey:"non-commercial-and-evaluation"})}),s.isError&&(s.error.response.status===404?e(m,{children:"The task has no data"}):i(m,{color:"rose",children:["Error fetching task data: ",s.error.message]}))]})})},on=({pipeline:n,run:t})=>{const[r,a]=g.useState(),s=ke(n.tasks);return i(C,{children:[e(an,{runId:t.id,taskId:r||"",open:!!r,onClose:()=>a(void 0)}),e(w,{children:"Tasks"}),e(J,{children:n.tasks.map((o,c)=>{var h;return i(k,{className:"space-x-4",children:[t.tasks_run[c]?e(M,{variant:"light",icon:G[t.tasks_run[c].status],color:j[t.tasks_run[c].status]}):e(M,{variant:"light",icon:G.notrun,color:j.notrun}),i("div",{className:"truncate flex-grow",children:[i(v,{className:"justify-start",children:[e("div",{className:`h-2 w-2 mr-2 rounded-full ${s[o.id]}`}),e(m,{className:"truncate",children:e(A,{children:o.name})})]}),o.description&&e(m,{className:"truncate",children:o.description})]}),((h=t.tasks_run[c])==null?void 0:h.has_output)&&e(N,{variant:"light",color:"indigo",size:"xs",icon:dt,onClick:()=>a(o.id),children:"Data"})]},o.id)})})]})},cn=()=>{const{lastJsonMessage:n}=ee(ie().toString()),t=Z(),r=se(),a=r.pipelineId,s=r.triggerId,o=parseInt(r.runId);g.useEffect(()=>{if(n){const{data:p,type:x}=n;x==="run-update"&&t.invalidateQueries({queryKey:["run",a,s,o]}).catch(()=>{})}},[n,a]);const c=S({queryKey:["pipeline",a],queryFn:()=>ae(a),initialData:{id:"",name:"",description:"",tasks:[],triggers:[]},enabled:!!a}),h=S({queryKey:["run",a,s,o],queryFn:()=>kt(o),enabled:!!(a&&s&&o)}),d=c.data,f=s===U.id?U:d.triggers.find(p=>p.id===s),l=h.data;if(!l)return e("div",{children:"Run not found"});if(!f)return e("div",{children:"Trigger not found"});const y=(l.tasks_run||[]).reduce((p,x)=>p+x.duration,0),b=(l.tasks_run||[]).map(p=>p.duration/y*100);return i(Q,{header:i(T,{children:[i(w,{children:["Run #",o]}),e(ue,{pipeline:d,trigger:f,run:l})]}),children:[i(D,{numColsMd:3,className:"gap-6 mt-6",children:[e(on,{pipeline:d,run:l}),i(C,{children:[i(v,{className:"items-start",children:[e(m,{children:"Duration"}),e(Oe,{status:l.status})]}),e(v,{className:"justify-start items-baseline space-x-3 truncate",children:i(Le,{children:[(l.duration/1e3).toFixed(1),"s"]})}),e(ut,{categoryPercentageValues:b,colors:H,showLabels:!1,className:"mt-3"})]})]}),e("div",{className:"mt-6",children:e(C,{children:e(en,{pipeline:d,runId:o})})})]})},ln=({children:n})=>{const{isAuthenticated:t,isLoading:r}=ce(),a=ht();return!t&&!r?e(mt,{to:"/login",replace:!0,state:{from:a}}):e(T,{children:n})},dn=Object.assign({"./pages/index.tsx":Bt,"./pages/login.tsx":Gt,"./pages/pipelines/[pipelineId]/index.tsx":zt,"./pages/pipelines/[pipelineId]/triggers/[triggerId]/index.tsx":Jt,"./pages/pipelines/[pipelineId]/triggers/[triggerId]/runs/[runId]/index.tsx":cn}),un=Object.entries(dn).map(([n,t])=>{const r=n.slice(7).replace(/(index)?\.tsx$/,"").split("/").map(a=>a.replace(/\[(.+)\]/,":$1")).join("/");return{path:r,element:r!=="/login"?e(ln,{children:e(t,{})}):e(t,{})}}),hn=()=>e(pt,{children:un.map(n=>e(gt,{path:n.path,element:n.element},n.path))}),mn=new ft({defaultOptions:{queries:{retry:!1}}});function pn(){return e(yt,{client:mn,children:e(vt,{children:e(At,{children:e(hn,{})})})})}xt.createRoot(document.getElementById("root")).render(e(Re.StrictMode,{children:e(pn,{})}));export{e as j};
