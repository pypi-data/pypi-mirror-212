(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[679],{7968:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/plots/[uuid]/grid",function(){return n(4108)}])},1575:function(e,t,n){"use strict";n.d(t,{b:function(){return d}});var i=n(5893),a=n(5675),l=n.n(a),s=n(7294);class o{width(){return this.xmax-this.xmin}height(){return this.ymax-this.ymin}constructor(e,t,n,i,a,l){this.xmin=e,this.ymin=t,this.xmax=n,this.ymax=i,this.color=a,this.label=l}}let c=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#0000FF","#00FF00","#FF0000","#00FFFF","#FF00FF","#FFFF00","#C0C0C0","#800000"];function d(e){let[t,n]=(0,s.useState)([]),[a,d]=(0,s.useState)({width:0,height:0,naturalWidth:0,naturalHeight:0}),[r,u]=(0,s.useState)([]),h=s.useRef(null);(0,s.useEffect)(()=>{if(null!=e.media.information&&null!=e.boundingBoxColumnIndex){let t=e.media.information[e.boundingBoxColumnIndex];if(null==t)return;let i=function(e){let t=JSON.parse(e),n=[];return t.forEach(e=>{let t=e.xmin,i=e.ymin,a=e.xmax,l=e.ymax;isNaN(t)||isNaN(i)||isNaN(a)||isNaN(l)||n.push(new o(t,i,a,l,e.color,e.label))}),n}(t);n(i)}},[e.media,e.boundingBoxColumnIndex]),s.useEffect(()=>{if(h.current){let t=h.current,n=t.offsetWidth,i=t.offsetHeight;if(1===e.columns){let e=function(e){let t=e.naturalWidth/e.naturalHeight,n=e.height*t,i=e.height;return n>e.width&&(n=e.width,i=e.width/t),{width:n,height:i}}(h.current);n=e.width,i=e.height}d({height:isNaN(i)?0:i,naturalWidth:isNaN(t.naturalWidth)?0:t.naturalWidth,naturalHeight:isNaN(t.naturalHeight)?0:t.naturalHeight,width:isNaN(n)?0:n})}},[e.media,e.columns,e.displayLabel]),(0,s.useEffect)(()=>{m()},[a]);let m=()=>{if(isNaN(a.width)||isNaN(a.height)||isNaN(a.naturalWidth)||isNaN(a.naturalHeight)||0===a.width||0===a.height||0===a.naturalHeight||0===a.naturalWidth)return;let n=t.map((t,n)=>{let{textLabel:l,rect:o,textRectangle:d}=function(t,n){let l;let s=(0,i.jsx)("rect",{x:n.xmin/a.naturalWidth*a.width,y:n.ymin/a.naturalHeight*a.height,width:(n.xmax-n.xmin)/a.naturalWidth*a.width,height:(n.ymax-n.ymin)/a.naturalHeight*a.height,stroke:null!=n.color?n.color:c[t%c.length],strokeWidth:"3",fill:"none"},t),o=(0,i.jsx)("rect",{x:n.xmin/a.naturalWidth*a.width,y:n.ymin/a.naturalHeight*a.height,width:(n.xmax-n.xmin)/a.naturalWidth*a.width,height:12,fill:null!=n.color?n.color:c[t%c.length]});return null!=n.label&&e.displayLabel&&(l=(0,i.jsx)("text",{x:n.xmin/a.naturalWidth*a.width+2,y:n.ymin/a.naturalHeight*a.height+10,fill:"white",className:"small",children:n.label})),{textLabel:l,rect:s,textRectangle:o}}(n,t);return(0,i.jsxs)(s.Fragment,{children:[o,null!=l?d:"",null!=l?l:""]},n)});u(n)};return(0,i.jsxs)("div",{className:"image--preview",children:[(0,i.jsx)(l(),{src:e.media.src,className:"sidebar-image",alt:"preview",ref:h,width:"0",height:"0",sizes:" ",style:{width:"auto",height:"auto"}},e.media.src),null==e.boundingBoxColumnIndex&&void 0!==e.boundingBoxColumnIndex&&(0,i.jsx)("svg",{className:"sidebar-svg",width:a.width,height:a.height,children:r})]})}},5703:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var i=n(5893);n(7294);var a=n(1575);function l(e){var t;let{media:n,columns:l,boundingBoxColumn:s}=e;return(0,i.jsxs)("div",{className:"sidebar text-dark",style:{display:"flex",flexDirection:"column",maxHeight:"calc(70vh - 35px)"},children:[(0,i.jsx)("div",{style:{maxHeight:"300px"},children:(0,i.jsx)(a.b,{media:n,boundingBoxColumnIndex:null!=s?l.indexOf(s):void 0,displayLabel:!0})}),(0,i.jsx)("div",{style:{overflowY:"scroll",flexGrow:1},children:null===(t=n.information)||void 0===t?void 0:t.filter((e,t)=>t!==(null!=s?l.indexOf(s):-1)).map((e,t)=>{var n;return n=l.slice(2),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"border-bottom",children:(0,i.jsx)("small",{children:n[t]})}),(0,i.jsx)("div",{children:e})]},t)})})]})}},8983:function(e,t,n){"use strict";n.d(t,{D:function(){return i}});class i{constructor(e,t,n,i,a,l,s,o,c,d,r){this.type=e,this.media=t,this.columns=n,this.title=i,this.x=a,this.y=l,this.color=s,this.size=o,this.symbol=c,this.bounding_box=d,this.colors=r}}},5670:function(e,t,n){"use strict";n.d(t,{T:function(){return i}});let i="";i=""},4108:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return g}});var i=n(5893),a=n(1163),l=n(7294),s=n(8983),o=n(6154),c=n(5670);async function d(e,t,n,i,a){return await o.Z.post("".concat(c.T,"/views/").concat(e,"/media"),{media_ids:t,page:null!==n?n:0,sort_column:void 0!==i?i:null,ascending:void 0!==a?a:null}).then(e=>e.data)}function r(e){return(0,i.jsxs)("div",{className:"btn-group btn-group-sm",role:"group","aria-label":"Basic example",children:[(0,i.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{e.handlePage(e.page-1)},disabled:0===e.page,children:"\xab"}),(0,i.jsxs)("button",{type:"button",className:"btn btn-outline-secondary",disabled:!0,children:[e.page+1," / ",e.maxPage+1]}),(0,i.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{e.handlePage(e.page+1)},disabled:e.page===e.maxPage,children:"\xbb"})]})}var u=n(1575);function h(e){let t=(0,i.jsx)(i.Fragment,{});if(null!=e.showColumn&&null!=e.media.information){let n=e.infoColumns.slice(2).indexOf(e.showColumn);t=(0,i.jsx)("div",{className:"col-12 media-grid-value text-dark text-small",children:(0,i.jsx)("div",{children:(0,i.jsx)("small",{children:e.media.information[n]})})})}return(0,i.jsx)("div",{className:"col-3 grid-media pb-4 media-col-".concat(e.columns),onClick:()=>e.handleClick(e.media.index),onMouseEnter:()=>e.handleHover(e.media.index),children:(0,i.jsxs)("div",{className:"row",children:[(0,i.jsx)("div",{className:"col-12",children:(0,i.jsx)(u.b,{media:e.media,boundingBoxColumnIndex:null!=e.boundingBoxColumn?e.infoColumns.indexOf(e.boundingBoxColumn):void 0,displayLabel:e.showBboxLabel,columns:e.columns})}),t]})},"".concat(e.media.index,"-").concat(e.media.src))}var m=n(6614),x=n(4186),f=n(5703);function g(){let e;let t=(0,a.useRouter)(),{uuid:n,media:o,sortBy:c,asc:u,page:g,show:v}=t.query;e={uuid:n,media:o,sortBy:c,asc:u,page:g,show:v};let[b,p]=(0,l.useState)(void 0!==e.page?parseInt(e.page):void 0),[N,j]=(0,l.useState)([]),w=decodeURIComponent(e.media).split(",").map(e=>parseInt(e)),[y,C]=(0,l.useState)(void 0!==e.asc&&"true"===e.asc),[k,F]=(0,l.useState)(void 0!==e.sortBy?e.sortBy:void 0),[_,B]=(0,l.useState)(new s.D("","",[])),[E,S]=(0,l.useState)(void 0!==e.show?e.show:void 0),[H,W]=(0,l.useState)(0),[I,O]=(0,l.useState)(!1),[P,L]=(0,l.useState)(void 0);function T(e){void 0!==n&&t.push("/plots/".concat(n,"/media/").concat(e),"/plots/".concat(n,"/media/").concat(e)).catch(e=>console.log(e))}function D(e){(0,x.o)(n,e).then(e=>{L(e)})}function Z(e,t){void 0!==e&&_.columns.includes(e)&&(F(e),C(t))}function R(){let e="";if(void 0!==b?e+="&page=".concat(b):e+="&page=0",void 0!==k&&(e+="&sortBy=".concat(k)),void 0!==y&&(e+="&asc=".concat(y.toString())),void 0!==E&&(e+="&show=".concat(E)),void 0!==o){if("string"==typeof o)e+="&media=".concat(o);else if(Array.isArray(o)){let t=o.join(",");e+="&media=".concat(t)}}return e}return(0,l.useEffect)(()=>{void 0!==g&&p(parseInt(g))},[g]),(0,l.useEffect)(()=>{void 0!==c&&F(c)},[c]),(0,l.useEffect)(()=>{void 0!==u&&C("true"===u)},[u]),(0,l.useEffect)(()=>{void 0!==v&&S(v)},[v]),(0,l.useEffect)(()=>{null!=n&&(0,m.i)(n).then(e=>B(e))},[n]),(0,l.useEffect)(()=>{void 0!==w&&0!==w.length&&void 0!==n&&void 0!==b&&d(n,w,b,k,y).then(e=>{let i=R();t.push("/plots/".concat(n,"/grid?").concat(i),"/plots/".concat(n,"/grid?").concat(i)).catch(e=>console.log(e)),j(e)}).catch(e=>console.log(e))},[k,y,n,b]),(0,l.useEffect)(()=>{if(void 0===E||void 0===n)return;let e=R();t.push("/plots/".concat(n,"/grid?").concat(e),"/plots/".concat(n,"/grid?").concat(e)).catch(e=>console.log(e))},[E]),void 0===n?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)("div",{className:"container-fluid",children:(0,i.jsxs)("div",{className:"row",children:[(0,i.jsx)("div",{className:"col-9",children:(0,i.jsxs)("div",{className:"row",children:[(0,i.jsx)("div",{className:"col-12 p-3 mb-1 border-bottom-1 border-secondary",children:(0,i.jsxs)("div",{className:"row justify-content-between",children:[(0,i.jsx)("div",{className:"col text-dark",children:(0,i.jsxs)("div",{className:"row",children:["grid"!==_.type&&(0,i.jsx)("div",{className:"col-2",children:(0,i.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>void t.back(),children:"Back"})}),(0,i.jsx)("div",{className:"col-3 text-dark",children:(0,i.jsxs)("small",{children:[w.length," selected"]})}),(0,i.jsx)("div",{className:"col-5",children:(0,i.jsx)("small",{children:(0,i.jsxs)("div",{className:"input-group input-group-sm",children:[(0,i.jsxs)("select",{name:"",className:"form-select form-select-sm",onChange:e=>Z(e.target.value,y),value:k,children:[(0,i.jsx)("option",{value:"",defaultValue:"",children:"Order by"}),_.columns.slice(2).map(e=>(0,i.jsx)("option",{value:e,children:e},e))]}),(0,i.jsx)("button",{className:"btn btn-outline-secondary",type:"button",onClick:()=>{Z(k,!y)},children:(0,i.jsx)("i",{className:"bi ".concat(y?"bi-sort-up":"bi-sort-down")})})]})})}),null!=_.bounding_box&&(0,i.jsx)("div",{className:"col-4",children:(0,i.jsx)("small",{children:(0,i.jsxs)("div",{className:"form-check",children:[(0,i.jsx)("input",{className:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault",checked:I,onChange:()=>{O(!I)}}),(0,i.jsx)("label",{className:"form-check-label",htmlFor:"flexCheckDefault",children:"Show bbox label"})]})})})]})}),(0,i.jsx)("div",{className:"col",children:(0,i.jsxs)("div",{className:"row justify-content-end",children:[(0,i.jsx)("div",{className:"col-4",children:(0,i.jsxs)("select",{name:"",className:"form-select form-select-sm",onChange:e=>S(e.target.value),value:E,children:[(0,i.jsx)("option",{value:"",defaultValue:"",children:"Show value"}),_.columns.slice(2).map(e=>(0,i.jsx)("option",{value:e,children:e},e))]})}),(0,i.jsx)("div",{className:"col-4",children:(0,i.jsx)("input",{type:"range",className:"form-range range--custom",min:1,max:10,onChange:e=>{W(parseInt(e.target.value))}})}),(0,i.jsx)("div",{className:"col-4 text-end",children:(0,i.jsx)(r,{handlePage:e=>p(e),maxPage:Math.floor(w.length/50),page:void 0===b?0:b})})]})})]})}),(0,i.jsx)("div",{className:"col-12",children:(0,i.jsx)("div",{className:"row row--media-grid",children:N.map(e=>(0,i.jsx)(h,{media:e,handleClick:T,handleHover:D,infoColumns:_.columns,columns:H,showColumn:E,boundingBoxColumn:_.bounding_box,showBboxLabel:I},e.index))})})]})}),(0,i.jsx)("div",{className:"col-3 p-3",children:null!=P&&(0,i.jsx)(f.Z,{media:P,columns:_.columns,boundingBoxColumn:_.bounding_box})})]})})}},6614:function(e,t,n){"use strict";n.d(t,{i:function(){return l}});var i=n(6154),a=n(5670);async function l(e){return await i.Z.get("".concat(a.T,"/views/").concat(e,"/config")).then(e=>e.data)}},4186:function(e,t,n){"use strict";n.d(t,{o:function(){return s}});var i=n(6154);class a{constructor(e,t,n,i,a){this.index=e,this.src=t,this.information=n,this.height=i,this.width=a}}var l=n(5670);async function s(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return await i.Z.get("".concat(l.T,"/views/").concat(e,"/media/").concat(t,"?&as_base64=").concat(n.toString())).then(e=>new a(e.data.index,e.data.src,e.data.information,e.data.height,e.data.width))}}},function(e){e.O(0,[845,774,888,179],function(){return e(e.s=7968)}),_N_E=e.O()}]);