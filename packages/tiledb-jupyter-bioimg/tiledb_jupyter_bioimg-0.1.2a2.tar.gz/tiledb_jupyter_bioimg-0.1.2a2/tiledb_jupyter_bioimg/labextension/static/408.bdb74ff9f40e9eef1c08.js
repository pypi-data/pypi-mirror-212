(()=>{var e,t,r={6286:(e,t,r)=>{"use strict";var n=r(3578),a=r.n(n),o=r(4551),s=r(9757);const l={uint8:{bytes:Uint8Array.BYTES_PER_ELEMENT,format:s.Z.RED_INTEGER,internalFormat:s.Z.R8UI,type:s.Z.UNSIGNED_BYTE,filtering:s.Z.NEAREST,samplerType:"usampler2DArray",max:255,create:function(e){return new Uint8Array(e)}},uint16:{bytes:Uint16Array.BYTES_PER_ELEMENT,format:s.Z.RED_INTEGER,internalFormat:s.Z.R16UI,type:s.Z.UNSIGNED_SHORT,filtering:s.Z.NEAREST,samplerType:"usampler2DArray",max:65535,create:function(e){return new Uint16Array(e)}}};class i{constructor(e,t){this.baseAxes=e,this.targetAxes=t,this.permutationMatrix=new Array(e.length);for(let e=0;e<this.baseAxes.length;++e){const t=this.targetAxes.indexOf(this.baseAxes[e]);this.permutationMatrix[e]=t}}reshape(e){const t=new Array(this.baseAxes.length);for(let r=0;r<this.baseAxes.length;++r)t[this.targetAxes.indexOf(this.baseAxes[r])]=e[r];return t}}function c(e){if(2===e.length)return e;const t=[];for(let r=0;r<e.length;r+=2)t.push([e[r],e[r+1]]);return t}function f(...e){const t=[],r=e.length-1;return function n(a,o){for(let s=0,l=e[o].length;s<l;s++){const l=a.slice(0);l.push(e[o][s]),o===r?t.push(l):n(l,o+1)}}([],0),t}function u(e){let t=1;const r=[];if(0===e.length)return r;for(let n=1;n<=e.length;n++)n===e.length||e[n]-e[n-1]!=1?(1===t?r.push([e[n-t],e[n-t]]):r.push([e[n-t],e[n-1]]),t=1):t++;return r}self.onmessage=async function(e){const t={apiKey:e.data.token,basePath:e.data.basePath},r=new(a())(t),n=e.data.levelRecord.dimensions[e.data.levelRecord.axes.indexOf("X")],s=e.data.levelRecord.dimensions[e.data.levelRecord.axes.indexOf("Y")],h=e.data.levelRecord.downsample,g=e.data.index.x,p=e.data.index.y,d=e.data.tileSize,x=e.data.attribute.type.toLowerCase(),b=e.data.levelRecord.axesMapping,y=new i(e.data.levelRecord.arrayAxes.map((t=>e.data.levelRecord.axesMapping.get(t))).flat(),["C","Y","X"]),v=new Array(y.baseAxes.length);for(let e=0;e<y.baseAxes.length;++e){const t=y.baseAxes[e];v[e]="X"===t||"Y"===t?h:1}const m=new Map;m.set("C",e.data.channelRanges),m.set("Y",[p*d*h,Math.min((p+1)*d*h,s)-1]),m.set("X",[g*d*h,Math.min((g+1)*d*h,n)-1]);const A=~~((m.get("X")[1]-m.get("X")[0]+1)/h),w=~~((m.get("Y")[1]-m.get("Y")[0]+1)/h);let E=0;for(let e=0;e<m.get("C").length;e+=2)E+=m.get("C")[e+1]-m.get("C")[e]+1;const R=function(e,t,r,n,a,o){const s=[];for(const l of r){const i=n.get(l);if(1===i.length)s.push(c(a.get(i[0])));else{const n=[];for(const r of i)n.push(e[t.indexOf(r)]);const c=new Array(i.length).fill(1);for(let e=0;e<n.length;++e)for(let t=e+1;t<n.length;++t)c[e]*=n[t];const h=[],g=[];for(const e of i){const t=[],r=[],n=a.get(e);for(let e=0;e<n.length;e+=2)t.push(n[e+1]-n[e]+1),r.push(n[e]);h.push(t),g.push(r)}const p=f(...h),d=f(...g),x=[],b=[];for(const e of d){let t=0;for(let r=0;r<e.length;++r)t+=e[r]*c[r];x.push(t)}for(const e of p){const t=new Array(i.length+1).fill(Number.MAX_SAFE_INTEGER,0,1).fill(1,1);for(let r=0;r<e.length;++r)for(let n=r+1;n<e.length;++n)t[r+1]*=e[n];b.push(t)}let y=0;const v=new Array(i.length),m=[],A=o[r.indexOf(l)];for(let e=0;e<p.length;++e){const t=p[e].reduce(((e,t)=>e*t),1);for(let r=0;r<t;++r){y=x[e];for(let t=0;t<b[e].length-1;++t)v[t]=~~(r%b[e][t]/b[e][t+1]),y+=v[t]*c[t];if(y>=A)return console.error("OOB"),[];m.push(y)}}m.sort(((e,t)=>e-t)),s.push(u(m))}}return s}(e.data.levelRecord.dimensions,e.data.levelRecord.axes,e.data.levelRecord.arrayAxes,b,m,e.data.levelRecord.arrayExtends);if(0===R.length)return;const S={layout:o.Layout.RowMajor,ranges:R,bufferSize:7e7,attributes:[e.data.attribute.name],returnRawBuffers:!0},_=r.query.ReadQuery(e.data.namespace,e.data.levelRecord.id,S),O=l[x].create(await _.next().then((t=>t.value[e.data.attribute.name]))),M=[];for(const t of e.data.levelRecord.arrayAxes)for(const r of e.data.levelRecord.axesMapping.get(t).flat())switch(r){case"X":case"Y":M.push(m.get(r)[1]-m.get(r)[0]+1);break;case"C":M.push(E)}const T=function(e,t,r,n){if(t.baseAxes.toString()===t.targetAxes.toString()&&1===Math.max(...n))return e;const a=t.reshape(r),o=t.reshape(n);let s=1;for(let e=0;e<a.length;++e)a[e]=~~(a[e]/o[e]),s*=a[e];const l=new e.constructor(s),i=new Array(t.baseAxes.length+1).fill(Number.MAX_SAFE_INTEGER,0,1).fill(1,1),c=new Array(t.baseAxes.length).fill(1);for(let e=0;e<r.length;++e)for(let t=e+1;t<r.length;++t)i[e+1]*=r[t],c[e]*=a[t];let f=0;const u=n.reduce(((e,t)=>e*t),1),h=new Array(t.baseAxes.length);for(let r=0;r<e.length;++r){f=0;for(let e=0;e<i.length-1;++e)h[e]=~~(r%i[e]/i[e+1]),f+=~~(h[e]/o[t.permutationMatrix[e]])*c[t.permutationMatrix[e]];l[f]+=e[r]/u}return l}(O,y,M,v);self.postMessage({data:T,width:A,height:w,channels:E},[T.buffer])}},8291:()=>{},4447:()=>{}},n={};function a(e){var t=n[e];if(void 0!==t)return t.exports;var o=n[e]={exports:{}};return r[e].call(o.exports,o,o.exports,a),o.exports}a.m=r,a.c=n,a.x=()=>{var e=a.O(void 0,[635],(()=>a(6286)));return a.O(e)},e=[],a.O=(t,r,n,o)=>{if(!r){var s=1/0;for(f=0;f<e.length;f++){for(var[r,n,o]=e[f],l=!0,i=0;i<r.length;i++)(!1&o||s>=o)&&Object.keys(a.O).every((e=>a.O[e](r[i])))?r.splice(i--,1):(l=!1,o<s&&(s=o));if(l){e.splice(f--,1);var c=n();void 0!==c&&(t=c)}}return t}o=o||0;for(var f=e.length;f>0&&e[f-1][2]>o;f--)e[f]=e[f-1];e[f]=[r,n,o]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,r)=>(a.f[r](e,t),t)),[])),a.u=e=>e+".f8f404497739316e801c.js?v=f8f404497739316e801c",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{a.S={};var e={},t={};a.I=(r,n)=>{n||(n=[]);var o=t[r];if(o||(o=t[r]={}),!(n.indexOf(o)>=0)){if(n.push(o),e[r])return e[r];a.o(a.S,r)||(a.S[r]={}),a.S[r];var s=[];return e[r]=s.length?Promise.all(s).then((()=>e[r]=1)):1}}})(),(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&!e;)e=r[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={408:1};a.f.i=(t,r)=>{e[t]||importScripts(a.p+a.u(t))};var t=self.webpackChunk_tiledb_inc_jupyter_bioimage_viewer=self.webpackChunk_tiledb_inc_jupyter_bioimage_viewer||[],r=t.push.bind(t);t.push=t=>{var[n,o,s]=t;for(var l in o)a.o(o,l)&&(a.m[l]=o[l]);for(s&&s(a);n.length;)e[n.pop()]=1;r(t)}})(),t=a.x,a.x=()=>a.e(635).then(t),a.x()})();