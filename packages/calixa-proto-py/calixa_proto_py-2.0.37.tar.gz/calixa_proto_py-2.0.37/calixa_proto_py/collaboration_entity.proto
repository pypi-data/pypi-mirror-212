syntax = "proto3";

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

import "common.proto";

import "oltpannotation.proto";

option java_package = "io.calixa.domain.collaboration";
option java_multiple_files = true;
option optimize_for = SPEED;

package calixa.domain.collaboration;

enum PinnedState {
  PINNED_STATE_UNSPECIFIED = 0;
  PINNED = 1;
  UNPINNED = 2;
}

enum ResolvedState {
  RESOLVED_STATE_UNSPECIFIED = 0;
  RESOLVED = 1;
  UNRESOLVED = 2;
}

enum ReadState {
  READ_STATE_UNSPECIFIED = 0;
  READ = 1;
  UNREAD = 2;
}

message Message {
  option (calixa.oltp.oltp_primary_key) = {field_ids: [1, 2]};

  string organization_id = 1;
  string message_id = 2;
  string thread_id = 3;
  string body = 4 [(calixa.oltp.oltp_field) = {nullable: false}];
  string author_id = 5 [(calixa.oltp.oltp_field) = {nullable: false}];
  PinnedState pinned = 6;
  ResolvedState resolved = 7;
  google.protobuf.Timestamp created_at = 500 [(calixa.oltp.oltp_field) = {nullable: false}];
  google.protobuf.Timestamp updated_at = 501 [(calixa.oltp.oltp_field) = {nullable: false}];
}

message Thread {
  option (calixa.oltp.oltp_primary_key) = {field_ids: [1, 2]};

  string organization_id = 1;
  string thread_id = 2;
  string title = 3 [(calixa.oltp.oltp_field) = {nullable: true}];

  // The entity off which this note hangs
  calixa.domain.common.EntityType for_entity_type = 4;
  // account, user ext id or event uuid
  string for_canonical_id = 5;

  PinnedState pinned = 6;
  ResolvedState resolved = 7;
  repeated Message messages = 8;
  int64 message_count = 9;

  Message latest_message = 10;

  google.protobuf.Timestamp created_at = 500 [(calixa.oltp.oltp_field) = {nullable: false}];
  google.protobuf.Timestamp updated_at = 501 [(calixa.oltp.oltp_field) = {nullable: false}];
}

message OrganizationUserNotification {
  string organization_id = 1;
  string notification_id = 2;
  string organization_user_id = 3;
  string thread_id = 4;
  ReadState read_state = 5;
  google.protobuf.Timestamp created_at = 500;
  google.protobuf.Timestamp updated_at = 501;
}
